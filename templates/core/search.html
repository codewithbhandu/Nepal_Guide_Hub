<!-- core/search.html -->
{% extends 'base.html' %}

{% block title %}Search - Nepal Guide Hub{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Search Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Discover Nepal</h1>
            <p class="text-xl text-gray-600">Find the perfect packages, guides, and agencies for your adventure</p>
        </div>

        <!-- Search Form -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <form method="GET" class="space-y-6">
                <!-- Main Search Bar -->
                <div class="flex flex-col lg:flex-row gap-4">
                    <div class="flex-1">
                        {{ form.query }}
                    </div>
                    <div class="lg:w-48">
                        {{ form.search_type }}
                    </div>
                    <button type="submit" class="bg-nepal-green-600 hover:bg-nepal-green-700 text-white px-8 py-2 rounded-lg font-medium transition-colors flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i>
                        Search
                    </button>
                </div>

                <!-- Advanced Filters -->
                <div class="border-t pt-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Package Type</label>
                            {{ form.package_type }}
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Minimum Price (NPR)</label>
                            {{ form.min_price }}
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Maximum Price (NPR)</label>
                            {{ form.max_price }}
                        </div>
                    </div>
                </div>
            </form>
        </div>

        {% if query %}
            <!-- Search Results Header -->
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">
                    Search Results for "{{ query }}"
                </h2>
                <p class="text-gray-600 mt-1">
                    Showing {{ results.packages|length }} packages, {{ results.guides|length }} guides, {{ results.agencies|length }} agencies
                </p>
            </div>

            <!-- Results: Packages -->
            {% if results.packages %}
            <div class="mb-10">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Packages</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for package in results.packages %}
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="flex items-start justify-between">
                            <h4 class="text-lg font-bold text-gray-900 mr-2 line-clamp-2">{{ package.title }}</h4>
                            <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800">{{ package.get_package_type_display }}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2 line-clamp-2">{{ package.description }}</p>
                        <div class="mt-3 text-sm text-gray-600 flex items-center justify-between">
                            <span><i class="fas fa-building mr-1"></i>{{ package.agency.name }}</span>
                            <span><i class="fas fa-clock mr-1"></i>{{ package.duration_days }} days</span>
                        </div>
                        <div class="mt-4 flex items-center justify-between">
                            <div class="text-nepal-blue font-bold text-lg">NPR {{ package.price_per_person }}</div>
                            <a href="{% url 'core:package_detail' package.slug %}" class="text-white bg-nepal-blue px-3 py-2 rounded hover:bg-blue-700 text-sm">View</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Results: Guides -->
            {% if results.guides %}
            <div class="mb-10">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Guides</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for guide in results.guides %}
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="flex items-center justify-between">
                            <h4 class="text-lg font-bold text-gray-900">{{ guide.name }}</h4>
                            <span class="text-sm text-gray-600"><i class="fas fa-star text-yellow-400 mr-1"></i>{{ guide.rating }} ({{ guide.total_ratings }})</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2 line-clamp-2">{{ guide.bio }}</p>
                        <div class="mt-3 text-sm text-gray-600 flex items-center justify-between">
                            <span><i class="fas fa-building mr-1"></i>{{ guide.agency.name }}</span>
                            <span><i class="fas fa-briefcase mr-1"></i>{{ guide.experience_years }} yrs</span>
                        </div>
                        <div class="mt-4 flex items-center justify-between">
                            <div class="text-nepal-blue font-bold text-lg">NPR {{ guide.daily_rate }}/day</div>
                            <a href="{% url 'core:guide_detail' guide.id %}" class="text-white bg-nepal-green px-3 py-2 rounded hover:bg-green-700 text-sm">View</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Results: Agencies -->
            {% if results.agencies %}
            <div class="mb-10">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Agencies</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for agency in results.agencies %}
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="flex items-center justify-between">
                            <h4 class="text-lg font-bold text-gray-900">{{ agency.name }}</h4>
                            <span class="text-sm text-gray-600"><i class="fas fa-star text-yellow-400 mr-1"></i>{{ agency.rating }} ({{ agency.total_ratings }})</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2 line-clamp-2">{{ agency.description }}</p>
                        <div class="mt-3 text-sm text-gray-600 flex items-center justify-between">
                            <span><i class="fas fa-users mr-1"></i>{{ agency.guides.count }} guides</span>
                            <span><i class="fas fa-box mr-1"></i>{{ agency.packages.count }} packages</span>
                        </div>
                        <div class="mt-4 flex items-center justify-end">
                            <a href="{% url 'core:agency_detail' agency.id %}" class="text-white bg-nepal-red px-3 py-2 rounded hover:bg-red-700 text-sm">View</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        {% else %}
            <!-- No Search Query - Show Popular Content -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Popular Searches -->
                <div class="lg:col-span-3">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Popular Searches</h3>
                    <div class="flex flex-wrap gap-2">
                        <a href="?query=everest" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors">
                            Everest Base Camp
                        </a>
                        <a href="?query=annapurna" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors">
                            Annapurna Circuit
                        </a>
                        <a href="?query=cultural" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors">
                            Cultural Tours
                        </a>
                        <a href="?query=kathmandu" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors">
                            Kathmandu Valley
                        </a>
                        <a href="?query=safari" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors">
                            Wildlife Safari
                        </a>
                        <a href="?query=adventure" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors">
                            Adventure Sports
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>
// Tab switching functionality
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // Remove active class from all buttons
            tabButtons.forEach(btn => {
                btn.classList.remove('active', 'border-nepal-green-500', 'text-nepal-green-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Add active class to clicked button
            this.classList.add('active', 'border-nepal-green-500', 'text-nepal-green-600');
            this.classList.remove('border-transparent', 'text-gray-500');
            
            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show target tab content
            document.getElementById(targetTab + '-tab').classList.remove('hidden');
        });
    });
});
</script>

<style>
.tab-btn {
    @apply whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer;
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}
